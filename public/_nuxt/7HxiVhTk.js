import{a as L,b as E,_ as U}from"./DPjHm7U3.js";import{v as b,D as h,aM as y,aN as F,e as w,ai as A,c as T,a as _,b as p,l as u,t as v,w as I,ah as V,o as C}from"./HxJPijIE.js";import{u as D}from"./5FU1LBy6.js";import"./Ala1UYN5.js";import"./BnchoiCd.js";import"./DiGSp3wD.js";const O=g=>{const a=b(null),o=b(null);return h(async()=>{const{liffId:s,login:N,liffInit:n,redirectUrl:e}=g,i=F(),l=()=>{if(i.public.ENVIRONMENT==="development")return(s==null?void 0:s.dev)||"";if(i.public.ENVIRONMENT==="production")return(s==null?void 0:s.production)||"";console.error("請補上環境變數",i.public.environment)};try{console.log("liffId",l());const r=(await y(async()=>{const{default:t}=await import("./y7bnSdfX.js");return{default:t}},[],import.meta.url)).default;await r.init({liffId:l()||""}),a.value=r,a.value.isLoggedIn()||r.login({redirectUri:e}),a.value.getProfile().then(t=>{o.value={displayName:t.displayName,pictureUrl:t.pictureUrl||"",statusMessage:t.statusMessage||"",userId:t.userId}})}catch(r){console.error("Failed to initialize LIFF:",r)}}),{LIFF:a,LineProfile:o}},B={class:"flex flex-col items-center justify-center"},M=["src"],P={class:"text-lg mt-2"},R={class:"text-sm text-gray-500"},Y=w({__name:"register",setup(g){const a=A(),{LineProfile:o}=O({liffId:{dev:"2007494898-BJjV7nbe",production:""},liffInit:!0,login:!0}),c=b({data:{form:{serialNumber:""}},feature:{submit:{isLoading:!1}}}),s=n=>{const e=[];return n.serialNumber||e.push({name:"serialNumber",message:"請輸入序號"}),e},N=async()=>{var t,d,m,f;const{feature:n,data:e}=c.value,{execute:i,error:l,status:r}=await D.activate({lineProfileId:((t=o==null?void 0:o.value)==null?void 0:t.userId)||"",serialNumber:e.form.serialNumber});if(n.submit.isLoading=!0,i(),n.submit.isLoading=!1,((m=(d=l.value)==null?void 0:d.data)==null?void 0:m.error)==="LINE_PROFILE_ID_ALREADY_EXISTS"){a.add({title:"已綁定過",color:"error"}),e.form.serialNumber="";return}if(((f=l.value)==null?void 0:f.data.error)==="ATTENDANCE_ACCOUNT_NOT_FOUND"){a.add({title:"序號錯誤",color:"error"}),e.form.serialNumber="";return}r.value==="success"&&(a.add({title:"綁定成功",color:"success"}),e.form.serialNumber="")};return(n,e)=>{var d,m,f;const i=U,l=E,r=L,t=V;return C(),T("div",B,[e[1]||(e[1]=_("h2",{class:"text-2xl font-extrabol mb-4"}," 點名者帳號綁定 ",-1)),_("img",{src:(d=u(o))==null?void 0:d.pictureUrl,alt:"Line Profile",class:"w-24 h-24 rounded-full border-4 border-white shadow-md"},null,8,M),_("p",P,v((m=u(o))==null?void 0:m.displayName),1),_("p",R," Id: "+v((f=u(o))==null?void 0:f.userId),1),p(r,{validate:s,ui:{root:"space-y-4"},state:u(c).data.form},{default:I(()=>[p(l,{label:"序號",name:"serialNumber"},{default:I(()=>[p(i,{modelValue:u(c).data.form.serialNumber,"onUpdate:modelValue":e[0]||(e[0]=x=>u(c).data.form.serialNumber=x),label:"序號",ui:{root:"w-full"}},null,8,["modelValue"])]),_:1},8,["name"])]),_:1},8,["state"]),p(t,{label:"註冊",loading:u(c).feature.submit.isLoading,onClick:N},null,8,["loading"])])}}});export{Y as default};
