import{ak as y,bb as u,h as M,l as b,v as _,aw as N,a3 as E,E as H,bc as R,M as x,i as K,bd as P,be as S,bf as V,bg as j}from"./CwVfjjN4.js";function z(a){return Array.isArray(a)?a:[a]}const T=a=>a==="defer"||a===!1;function U(...a){var p;const s=typeof a[a.length-1]=="string"?a.pop():void 0;typeof a[0]!="string"&&a.unshift(s);let[t,o,e={}]=a;if(typeof t!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof o!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const r=y(),C=o,O=()=>u.value,B=()=>r.isHydrating?r.payload.data[t]:r.static.data[t];e.server??(e.server=!0),e.default??(e.default=O),e.getCachedData??(e.getCachedData=B),e.lazy??(e.lazy=!1),e.immediate??(e.immediate=!0),e.deep??(e.deep=u.deep),e.dedupe??(e.dedupe="cancel");const f=e.getCachedData(t,r),h=f!=null;if(!r._asyncData[t]||!e.immediate){(p=r.payload._errors)[t]??(p[t]=u.errorValue);const i=e.deep?_:N;r._asyncData[t]={data:i(h?f:e.default()),pending:_(!h),error:E(r.payload._errors,t),status:_("idle"),_default:e.default}}const n={...r._asyncData[t]};delete n._default,n.refresh=n.execute=(i={})=>{if(r._asyncDataPromises[t]){if(T(i.dedupe??e.dedupe))return r._asyncDataPromises[t];r._asyncDataPromises[t].cancelled=!0}if(i._initial||r.isHydrating&&i._initial!==!1){const l=i._initial?f:e.getCachedData(t,r);if(l!=null)return Promise.resolve(l)}n.pending.value=!0,n.status.value="pending";const d=new Promise((l,c)=>{try{l(C(r))}catch(D){c(D)}}).then(async l=>{if(d.cancelled)return r._asyncDataPromises[t];let c=l;e.transform&&(c=await e.transform(l)),e.pick&&(c=F(c,e.pick)),r.payload.data[t]=c,n.data.value=c,n.error.value=u.errorValue,n.status.value="success"}).catch(l=>{if(d.cancelled)return r._asyncDataPromises[t];n.error.value=j(l),n.data.value=b(e.default()),n.status.value="error"}).finally(()=>{d.cancelled||(n.pending.value=!1,delete r._asyncDataPromises[t])});return r._asyncDataPromises[t]=d,r._asyncDataPromises[t]},n.clear=()=>w(r,t);const m=()=>n.refresh({_initial:!0}),v=e.server!==!1&&r.payload.serverRendered;{const i=H();if(i&&v&&e.immediate&&!i.sp&&(i.sp=[]),i&&!i._nuxtOnBeforeMountCbs){i._nuxtOnBeforeMountCbs=[];const c=i._nuxtOnBeforeMountCbs;R(()=>{c.forEach(D=>{D()}),c.splice(0,c.length)}),x(()=>c.splice(0,c.length))}v&&r.isHydrating&&(n.error.value||f!=null)?(n.pending.value=!1,n.status.value=n.error.value?"error":"success"):i&&(r.payload.serverRendered&&r.isHydrating||e.lazy)&&e.immediate?i._nuxtOnBeforeMountCbs.push(m):e.immediate&&m();const d=S();if(e.watch){const c=K(e.watch,()=>n.refresh());d&&P(c)}const l=r.hook("app:data:refresh",async c=>{(!c||c.includes(t))&&await n.refresh()});d&&P(l)}const g=Promise.resolve(r._asyncDataPromises[t]).then(()=>n);return Object.assign(g,n),g}function q(a){const s=y();return a in s.payload.data||(s.payload.data[a]=u.value),{data:M({get(){var t;return((t=s._asyncData[a])==null?void 0:t.data.value)??s.payload.data[a]},set(t){s._asyncData[a]?s._asyncData[a].data.value=t:s.payload.data[a]=t}})}}async function G(a){await new Promise(t=>V(t));const s=a?z(a):void 0;await y().hooks.callHookParallel("app:data:refresh",s)}function J(a){const s=y(),o=Object.keys(s.payload.data);for(const e of o)w(s,e)}function w(a,s){s in a.payload.data&&(a.payload.data[s]=void 0),s in a.payload._errors&&(a.payload._errors[s]=u.errorValue),a._asyncData[s]&&(a._asyncData[s].data.value=b(a._asyncData[s]._default()),a._asyncData[s].error.value=u.errorValue,a._asyncData[s].pending.value=!1,a._asyncData[s].status.value="idle"),s in a._asyncDataPromises&&(a._asyncDataPromises[s]&&(a._asyncDataPromises[s].cancelled=!0),a._asyncDataPromises[s]=void 0)}function F(a,s){const t={};for(const o of s)t[o]=a[o];return t}export{U as a,J as c,G as r,q as u};
