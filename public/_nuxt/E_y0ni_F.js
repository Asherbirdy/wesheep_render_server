import{_ as R}from"./Cn4W1oC_.js";import{e as B,ai as D,v as I,ag as w,i as F,c as L,b as i,w as c,o as h,a as r,t as m,l as e,j,A as q,ah as S}from"./Bvc7Ex_v.js";import{a as X,b as $,_ as K}from"./CtgkJVDo.js";import{_ as z}from"./BmytO-AW.js";import{u as T}from"./BANOoEP9.js";import{u as G}from"./DDGq6qOJ.js";import"./DNnAtfCG.js";import"./DDX8zJQ6.js";import"./B47zN4Cw.js";import"./Cq4Ps3MP.js";import"./BSkKV-LQ.js";const H={class:"flex flex-col justify-between gap-4 h-full"},J={class:""},re=B({__name:"index",async setup(Q){let t,u;const p=D(),a=I({data:{emailVerifiedModal:{OTP:""}},feature:{emailCountdown:{status:!1,time:60,countdown:0}}}),{data:s}=([t,u]=w(()=>G.showMe()),t=await t,u(),t),{execute:E}=([t,u]=w(()=>T.sendOTP()),t=await t,u(),t),{execute:P,error:b,status:y}=([t,u]=w(()=>T.bindOTPEmail(a.value.data.emailVerifiedModal)),t=await t,u(),t),v=async()=>{const{emailCountdown:o}=a.value.feature;await E(),o.status=!0,o.countdown=o.time},g=async()=>{var _,d;const{data:o}=a.value;if(await P(),((_=b.value)==null?void 0:_.data.error)==="INVALID_OTP"){p.add({title:"不正確的驗證碼",color:"error"}),o.emailVerifiedModal.OTP="";return}if(["ACCOUNT_BLOCKED","OTP_EXPIRED","OTP_NOT_FOUND_OR_EXPIRED"].includes((d=b.value)==null?void 0:d.data.error)){p.add({title:"帳號已停用驗證，請聯絡管理員",color:"error"}),o.emailVerifiedModal.OTP="";return}p.add({title:"驗證成功 | 5秒後請重新登入",color:"success"})};F(a.value.feature.emailCountdown,o=>{const{feature:l}=a.value;if(o.countdown>0){setTimeout(()=>{l.emailCountdown.countdown--},1e3);return}l.emailCountdown.status=!1,l.emailCountdown.countdown=l.emailCountdown.time});const U=o=>{const l=[];return o.OTP||l.push({name:"OTP",message:"驗證碼不能為空"}),l};return(o,l)=>{const _=R,d=S,M=K,k=$,A=X,N=z;return h(),L("div",H,[i(_,null,{default:c(()=>{var n,f,V,C,x,O;return[r("h2",null,"姓名："+m((n=e(s))==null?void 0:n.user.name),1),r("h2",null,"電子信箱："+m((f=e(s))==null?void 0:f.user.email),1),r("h2",null,"區域："+m((V=e(s))==null?void 0:V.user.district.name),1),r("h2",null,"Email驗證："+m((C=e(s))!=null&&C.user.emailVerified?"已驗證":"未驗證"),1),r("h2",null,"權限："+m((x=e(s))==null?void 0:x.user.role),1),r("h2",null,"部落格權限："+m((O=e(s))==null?void 0:O.user.landingPageAccess),1)]}),_:1}),i(N,{dismissible:!1,title:"Email驗證"},{body:c(()=>{var n;return[i(A,{state:(n=e(a).data)==null?void 0:n.emailVerifiedModal,validate:U},{default:c(()=>[r("div",J,[i(k,{label:"驗證碼",name:"otp",class:"flex-1 justify-between w-full gap-4 mb-2"},{default:c(()=>[i(M,{modelValue:e(a).data.emailVerifiedModal.OTP,"onUpdate:modelValue":l[0]||(l[0]=f=>e(a).data.emailVerifiedModal.OTP=f),label:"驗證碼",class:"flex-1 w-[calc(100%-124px)] mr-1",placeholder:"請輸入驗證碼"},null,8,["modelValue"]),i(d,{disabled:e(a).feature.emailCountdown.status,label:e(a).feature.emailCountdown.status?`${e(a).feature.emailCountdown.countdown}秒`:"寄送 Email 驗證",variant:"soft",class:"inline-block",onClick:v},null,8,["disabled","label"])]),_:1})])]),_:1},8,["state"]),i(d,{label:"驗證 Email",block:"",disabled:e(a).data.emailVerifiedModal.OTP.length<4,loading:e(y)==="pending",onClick:g},null,8,["disabled","loading"])]}),default:c(()=>{var n;return[(n=e(s))!=null&&n.user.emailVerified?q("",!0):(h(),j(d,{key:0,label:"Email 驗證",block:""}))]}),_:1})])}}});export{re as default};
