import{_ as q,a as B}from"./CXwxTuKY.js";import{U as T,e as P,r as j,g as f,h as F,c as N,o as x,b as s,w as c,a as u,t as r,i as t,j as O,k as I,l as S}from"./CTl1oznX.js";import{_ as z,a as D,b as G}from"./DLkIMbPX.js";import{u as C}from"./CTcQpaCG.js";import{u as $}from"./DlCxXzD7.js";import"./vbm2w1uJ.js";import"./D-rPpiA-.js";import"./CBTgIFOp.js";const H={showMe:async()=>$(T.UserShowMe,{method:"GET",server:!1,lazy:!0})},J={class:"flex flex-col justify-between gap-4 h-full"},K={class:""},oe=P({__name:"index",async setup(L){let a,i;const e=j({data:{emailVerifiedModal:{otp:""}},feature:{emailCountdown:{status:!1,time:60,countdown:0}}}),{data:l}=([a,i]=f(()=>H.showMe()),a=await a,i(),a),{execute:V}=([a,i]=f(()=>C.sendOTP()),a=await a,i(),a),{execute:y}=([a,i]=f(()=>C.bindOTPEmail({OTP:e.value.data.emailVerifiedModal.otp})),a=await a,i(),a),U=async()=>{const{emailCountdown:o}=e.value.feature;await V(),o.status=!0,o.countdown=o.time},v=async()=>{await y()};F(e.value.feature.emailCountdown,o=>{if(o.countdown>0){setTimeout(()=>{e.value.feature.emailCountdown.countdown--},1e3);return}e.value.feature.emailCountdown.status=!1,e.value.feature.emailCountdown.countdown=e.value.feature.emailCountdown.time});const E=o=>{const m=[];return o.otp||m.push({name:"otp",message:"驗證碼不能為空"}),m};return(o,m)=>{const k=q,_=S,M=G,g=D,A=z,R=B;return x(),N("div",J,[s(k,null,{default:c(()=>{var n,d,p,w,b,h;return[u("h2",null,"姓名："+r((n=t(l))==null?void 0:n.user.name),1),u("h2",null,"電子信箱："+r((d=t(l))==null?void 0:d.user.email),1),u("h2",null,"區域："+r((p=t(l))==null?void 0:p.user.district.name),1),u("h2",null,"Email驗證："+r((w=t(l))!=null&&w.user.emailVerified?"已驗證":"未驗證"),1),u("h2",null,"權限："+r((b=t(l))==null?void 0:b.user.role),1),u("h2",null,"部落格權限："+r((h=t(l))==null?void 0:h.user.landingPageAccess),1)]}),_:1}),s(R,{dismissible:!1,title:"Email驗證"},{body:c(()=>{var n;return[s(A,{state:(n=t(e).data)==null?void 0:n.emailVerifiedModal,validate:E},{default:c(()=>[u("div",K,[s(g,{label:"驗證碼",name:"otp",class:"flex-1 justify-between w-full gap-4 mb-2"},{default:c(()=>[s(M,{modelValue:t(e).data.emailVerifiedModal.otp,"onUpdate:modelValue":m[0]||(m[0]=d=>t(e).data.emailVerifiedModal.otp=d),label:"驗證碼",class:"flex-1 w-[calc(100%-124px)] mr-1",placeholder:"請輸入驗證碼"},null,8,["modelValue"]),s(_,{disabled:t(e).feature.emailCountdown.status,label:t(e).feature.emailCountdown.status?`${t(e).feature.emailCountdown.countdown}秒`:"寄送 Email 驗證",variant:"soft",class:"inline-block",onClick:U},null,8,["disabled","label"])]),_:1})])]),_:1},8,["state"]),s(_,{label:"驗證 Email",block:"",onClick:v})]}),default:c(()=>{var n;return[(n=t(l))!=null&&n.user.emailVerified?I("",!0):(x(),O(_,{key:0,label:"Email 驗證",block:""}))]}),_:1})])}}});export{oe as default};
