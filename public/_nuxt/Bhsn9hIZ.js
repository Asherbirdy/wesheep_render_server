import{e as R,$ as P,j as x,o as U,w as m,b as l,ai as S,v as W,ag as V,D as B,aK as g,aL as w,aC as k,aD as b,l as o,ah as H}from"./HxJPijIE.js";import{_ as D}from"./CNGA46rd.js";import{u as T}from"./jCW86xeN.js";import{a as C,_ as q,b as y}from"./DPjHm7U3.js";import"./BAJRQeT-.js";import"./DMtBr7_n.js";import"./HQmLrecV.js";import"./CPtGQ7Mt.js";import"./R8dsGkxS.js";import"./BnchoiCd.js";import"./DiGSp3wD.js";import"./Ala1UYN5.js";const N={email:/^[^\s@]+@[^\s@][^\s.@]*\.[^\s@]+$/},j=R({__name:"LoginFormComponent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(_){const a=P(_,"modelValue"),u=s=>{const e=[];return s.email||e.push({name:"email",message:"Required"}),N.email.test(String(s.email))||e.push({name:"email",message:"Invalid email format"}),s.password||e.push({name:"password",message:"Required"}),e};return(s,e)=>{const r=q,d=y,c=C;return U(),x(c,{state:a.value,validate:u,class:"flex flex-col gap-4"},{default:m(()=>[l(d,{label:"Email",name:"email"},{default:m(()=>[l(r,{modelValue:a.value.email,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.email=n),class:"w-full"},null,8,["modelValue"])]),_:1}),l(d,{label:"Password",name:"password"},{default:m(()=>[l(r,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.password=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["state"])}}}),K=R({__name:"RegisterFormComponent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(_){const a=P(_,"modelValue"),u=s=>{var r;const e=[];return s.name||e.push({name:"name",message:"Required"}),N.email.test(String(s.email))||e.push({name:"email",message:"Invalid email format"}),s.password||e.push({name:"password",message:"Required"}),(r=s==null?void 0:s.password)!=null&&r.length&&s.password.length<8&&e.push({name:"password",message:"密碼長度至少8個字"}),s.confirmPassword||e.push({name:"confirmPassword",message:"Required"}),s.password!==s.confirmPassword&&e.push({name:"confirmPassword",message:"Password does not match"}),s.serialNumber||e.push({name:"serialNumber",message:"Required"}),e};return(s,e)=>{const r=q,d=y,c=C;return U(),x(c,{state:a.value,validate:u,class:"flex flex-col gap-4"},{default:m(()=>[l(d,{label:"姓名",name:"name"},{default:m(()=>[l(r,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.name=n),class:"w-full"},null,8,["modelValue"])]),_:1}),l(d,{label:"Email",name:"email"},{default:m(()=>[l(r,{modelValue:a.value.email,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.email=n),class:"w-full"},null,8,["modelValue"])]),_:1}),l(d,{label:"密碼",name:"password"},{default:m(()=>[l(r,{modelValue:a.value.password,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.password=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1}),l(d,{label:"確認密碼",name:"confirmPassword"},{default:m(()=>[l(r,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.confirmPassword=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1}),l(d,{label:"序號",name:"serialNumber"},{default:m(()=>[l(r,{modelValue:a.value.serialNumber,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.serialNumber=n),class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["state"])}}}),re=R({__name:"login",async setup(_){let a,u;const s=S(),e=W({data:{login:{email:"",password:""},register:{name:"",email:"",password:"",confirmPassword:"",serialNumber:""}}}),{data:r,execute:d,error:c,status:n}=([a,u]=V(()=>T.login(e.value.data.login)),a=await a,u(),a),{data:h,execute:F,status:$,error:L}=([a,u]=V(()=>T.register(e.value.data.register)),a=await a,u(),a),{data:A,refresh:E}=([a,u]=V(()=>T.checkValidToken()),a=await a,u(),a),I=[{label:"登入",icon:"i-lucide-user",slot:"login"},{label:"註冊",icon:"i-lucide-lock",slot:"register"}],J=async()=>{var v,f;const{login:t}=e.value.data;if(await d(),c.value){s.add({title:"錯誤帳號或密碼",color:"error"}),console.error(c.value),t.password="";return}const i=g(w.AccessToken),p=g(w.RefreshToken);i.value=((v=r.value)==null?void 0:v.token.accessTokenJWT)||"",p.value=((f=r.value)==null?void 0:f.token.refreshTokenJWT)||"",k(b.Home)},M=async()=>{var i,p;const{register:t}=e.value.data;if(await F(),L.value){s.add({title:"錯誤序號或重複註冊",color:"error"}),t.serialNumber="",t.password="",t.confirmPassword="";return}s.add({title:"註冊成功 請登入",color:"success"}),t.name="",t.email="",t.password="",t.confirmPassword="",t.serialNumber="",g(w.AccessToken).value=(i=h.value)==null?void 0:i.token.accessTokenJWT,g(w.RefreshToken).value=(p=h.value)==null?void 0:p.token.refreshTokenJWT,k(b.Home)};return B(async()=>{var p;const t=g(w.AccessToken),i=g(w.RefreshToken);t.value&&i.value&&(await E(),((p=A.value)==null?void 0:p.msg)==="Token is valid"&&k(b.Home))}),(t,i)=>{const p=H,v=D;return U(),x(v,{items:I,class:"gap-4 w-full",ui:{trigger:"flex-1"}},{login:m(()=>[l(o(j),{modelValue:o(e).data.login,"onUpdate:modelValue":i[0]||(i[0]=f=>o(e).data.login=f)},null,8,["modelValue"]),l(p,{label:"登入",type:"submit",variant:"soft",class:"self-end",loading:o(n)==="pending",disabled:!o(e).data.login.email||!o(e).data.login.password||!o(e).data.login.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/),onClick:J},null,8,["loading","disabled"])]),register:m(()=>[l(o(K),{modelValue:o(e).data.register,"onUpdate:modelValue":i[1]||(i[1]=f=>o(e).data.register=f)},null,8,["modelValue"]),l(p,{label:"註冊",type:"submit",variant:"soft",class:"self-end",loading:o($)==="pending",disabled:!o(e).data.register.name||!o(e).data.register.email||!o(e).data.register.password||!o(e).data.register.confirmPassword||!o(e).data.register.serialNumber||!o(e).data.register.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||o(e).data.register.password!==o(e).data.register.confirmPassword,onClick:M},null,8,["loading","disabled"])]),_:1})}}});export{re as default};
