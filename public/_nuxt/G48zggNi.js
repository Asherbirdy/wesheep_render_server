import{a as P,_ as R}from"./1tTMQe0L.js";import{e as T,v as j,ag as f,i as q,c as F,b as s,w as c,o as C,a as i,t as m,l as t,j as N,A as O,ah as I}from"./CJ1hmjfG.js";import{a as D,b as S,_ as $}from"./CTniawRl.js";import{u as h}from"./-UYv5QZx.js";import{u as z}from"./CpwpnECx.js";import"./D4vmFw8Y.js";import"./Dccidqh2.js";import"./B3fnfiUs.js";import"./CGG-KMyI.js";import"./wnGBfK5N.js";const G={class:"flex flex-col justify-between gap-4 h-full"},H={class:""},oe=T({__name:"index",async setup(J){let a,u;const e=j({data:{emailVerifiedModal:{otp:""}},feature:{emailCountdown:{status:!1,time:60,countdown:0}}}),{data:l}=([a,u]=f(()=>z.showMe()),a=await a,u(),a),{execute:V}=([a,u]=f(()=>h.sendOTP()),a=await a,u(),a),{execute:v}=([a,u]=f(()=>h.bindOTPEmail({OTP:e.value.data.emailVerifiedModal.otp})),a=await a,u(),a),y=async()=>{const{emailCountdown:o}=e.value.feature;await V(),o.status=!0,o.countdown=o.time},E=async()=>{await v()};q(e.value.feature.emailCountdown,o=>{if(o.countdown>0){setTimeout(()=>{e.value.feature.emailCountdown.countdown--},1e3);return}e.value.feature.emailCountdown.status=!1,e.value.feature.emailCountdown.countdown=e.value.feature.emailCountdown.time});const k=o=>{const r=[];return o.otp||r.push({name:"otp",message:"驗證碼不能為空"}),r};return(o,r)=>{const U=P,_=I,g=$,M=S,A=D,B=R;return C(),F("div",G,[s(U,null,{default:c(()=>{var n,d,p,w,b,x;return[i("h2",null,"姓名："+m((n=t(l))==null?void 0:n.user.name),1),i("h2",null,"電子信箱："+m((d=t(l))==null?void 0:d.user.email),1),i("h2",null,"區域："+m((p=t(l))==null?void 0:p.user.district.name),1),i("h2",null,"Email驗證："+m((w=t(l))!=null&&w.user.emailVerified?"已驗證":"未驗證"),1),i("h2",null,"權限："+m((b=t(l))==null?void 0:b.user.role),1),i("h2",null,"部落格權限："+m((x=t(l))==null?void 0:x.user.landingPageAccess),1)]}),_:1}),s(B,{dismissible:!1,title:"Email驗證"},{body:c(()=>{var n;return[s(A,{state:(n=t(e).data)==null?void 0:n.emailVerifiedModal,validate:k},{default:c(()=>[i("div",H,[s(M,{label:"驗證碼",name:"otp",class:"flex-1 justify-between w-full gap-4 mb-2"},{default:c(()=>[s(g,{modelValue:t(e).data.emailVerifiedModal.otp,"onUpdate:modelValue":r[0]||(r[0]=d=>t(e).data.emailVerifiedModal.otp=d),label:"驗證碼",class:"flex-1 w-[calc(100%-124px)] mr-1",placeholder:"請輸入驗證碼"},null,8,["modelValue"]),s(_,{disabled:t(e).feature.emailCountdown.status,label:t(e).feature.emailCountdown.status?`${t(e).feature.emailCountdown.countdown}秒`:"寄送 Email 驗證",variant:"soft",class:"inline-block",onClick:y},null,8,["disabled","label"])]),_:1})])]),_:1},8,["state"]),s(_,{label:"驗證 Email",block:"",onClick:E})]}),default:c(()=>{var n;return[(n=t(l))!=null&&n.user.emailVerified?O("",!0):(C(),N(_,{key:0,label:"Email 驗證",block:""}))]}),_:1})])}}});export{oe as default};
