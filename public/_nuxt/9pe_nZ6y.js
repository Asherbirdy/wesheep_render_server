import{e as R,$ as P,n as x,o as T,w as i,b as o,ab as S,r as W,Q as v,m as B,a2 as V,ac as b,k as l,O as H,ad as g,ae as w}from"./ArC7e_0T.js";import{_ as O}from"./DIU0eXbN.js";import{_ as h,b as C,a as q,u as k}from"./CqpbSi7e.js";import"./B8jOrvaD.js";import"./fnlKtVFQ.js";import"./vm58Zihg.js";import"./Cf0d_sNn.js";const y={email:/^[^\s@]+@[^\s@][^\s.@]*\.[^\s@]+$/},Q=R({__name:"LoginFormComponent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(f){const a=P(f,"modelValue"),m=s=>{const e=[];return s.email||e.push({name:"email",message:"Required"}),y.email.test(String(s.email))||e.push({name:"email",message:"Invalid email format"}),s.password||e.push({name:"password",message:"Required"}),e};return(s,e)=>{const r=C,u=q,c=h;return T(),x(c,{state:a.value,validate:m,class:"flex flex-col gap-4"},{default:i(()=>[o(u,{label:"Email",name:"email"},{default:i(()=>[o(r,{modelValue:a.value.email,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.email=n),class:"w-full"},null,8,["modelValue"])]),_:1}),o(u,{label:"Password",name:"password"},{default:i(()=>[o(r,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.password=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["state"])}}}),j=R({__name:"RegisterFormComponent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(f){const a=P(f,"modelValue"),m=s=>{var r;const e=[];return s.name||e.push({name:"name",message:"Required"}),y.email.test(String(s.email))||e.push({name:"email",message:"Invalid email format"}),s.password||e.push({name:"password",message:"Required"}),(r=s==null?void 0:s.password)!=null&&r.length&&s.password.length<8&&e.push({name:"password",message:"密碼長度至少8個字"}),s.confirmPassword||e.push({name:"confirmPassword",message:"Required"}),s.password!==s.confirmPassword&&e.push({name:"confirmPassword",message:"Password does not match"}),s.serialNumber||e.push({name:"serialNumber",message:"Required"}),e};return(s,e)=>{const r=C,u=q,c=h;return T(),x(c,{state:a.value,validate:m,class:"flex flex-col gap-4"},{default:i(()=>[o(u,{label:"姓名",name:"name"},{default:i(()=>[o(r,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.name=n),class:"w-full"},null,8,["modelValue"])]),_:1}),o(u,{label:"Email",name:"email"},{default:i(()=>[o(r,{modelValue:a.value.email,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.email=n),class:"w-full"},null,8,["modelValue"])]),_:1}),o(u,{label:"密碼",name:"password"},{default:i(()=>[o(r,{modelValue:a.value.password,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.password=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1}),o(u,{label:"確認密碼",name:"confirmPassword"},{default:i(()=>[o(r,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.confirmPassword=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1}),o(u,{label:"序號",name:"serialNumber"},{default:i(()=>[o(r,{modelValue:a.value.serialNumber,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.serialNumber=n),class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["state"])}}}),ae=R({__name:"login",async setup(f){let a,m;const s=S(),e=W({data:{login:{email:"",password:""},register:{name:"",email:"",password:"",confirmPassword:"",serialNumber:""}}}),{data:r,execute:u,error:c,status:n}=([a,m]=v(()=>k.login(e.value.data.login)),a=await a,m(),a),{data:U,execute:N,status:F,error:$}=([a,m]=v(()=>k.register(e.value.data.register)),a=await a,m(),a),{data:L,refresh:A}=([a,m]=v(()=>k.checkValidToken()),a=await a,m(),a),E=[{label:"登入",icon:"i-lucide-user",slot:"login"},{label:"註冊",icon:"i-lucide-lock",slot:"register"}],I=async()=>{var d,p;const{login:t}=e.value.data;if(await u(),c.value){s.add({title:"錯誤帳號或密碼",color:"error"}),console.error(c.value),t.password="";return}g(w.AccessToken).value=(d=r.value)==null?void 0:d.token.accessTokenJWT,g(w.RefreshToken).value=(p=r.value)==null?void 0:p.token.refreshTokenJWT,V(b.Home)},J=async()=>{var d,p;const{register:t}=e.value.data;if(await N(),$.value){s.add({title:"錯誤序號或重複註冊",color:"error"}),t.serialNumber="",t.password="",t.confirmPassword="";return}s.add({title:"註冊成功 請登入",color:"success"}),t.name="",t.email="",t.password="",t.confirmPassword="",t.serialNumber="",g(w.AccessToken).value=(d=U.value)==null?void 0:d.token.accessTokenJWT,g(w.RefreshToken).value=(p=U.value)==null?void 0:p.token.refreshTokenJWT,V(b.Home)};return B(async()=>{var t;await A(),((t=L.value)==null?void 0:t.msg)==="Token is valid"&&V(b.Home)}),(t,d)=>{const p=H,M=O;return T(),x(M,{items:E,class:"gap-4 w-full",ui:{trigger:"flex-1"}},{login:i(()=>[o(l(Q),{modelValue:l(e).data.login,"onUpdate:modelValue":d[0]||(d[0]=_=>l(e).data.login=_)},null,8,["modelValue"]),o(p,{label:"登入",type:"submit",variant:"soft",class:"self-end",loading:l(n)==="pending",disabled:!l(e).data.login.email||!l(e).data.login.password||!l(e).data.login.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/),onClick:I},null,8,["loading","disabled"])]),register:i(()=>[o(l(j),{modelValue:l(e).data.register,"onUpdate:modelValue":d[1]||(d[1]=_=>l(e).data.register=_)},null,8,["modelValue"]),o(p,{label:"註冊",type:"submit",variant:"soft",class:"self-end",loading:l(F)==="pending",disabled:!l(e).data.register.name||!l(e).data.register.email||!l(e).data.register.password||!l(e).data.register.confirmPassword||!l(e).data.register.serialNumber||!l(e).data.register.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||l(e).data.register.password!==l(e).data.register.confirmPassword,onClick:J},null,8,["loading","disabled"])]),_:1})}}});export{ae as default};
