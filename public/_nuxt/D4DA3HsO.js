import{e as T,$ as P,j as x,o as U,w as i,b as l,aJ as M,v as S,ag as V,D as W,aA as b,aB as k,l as o,ah as H,aK as _,aL as v}from"./CUmCUkJp.js";import{_ as j}from"./DP7FLkZ3.js";import{u as R}from"./BeRUXZ6u.js";import{a as C,_ as q,b as y}from"./DMOJ8-yp.js";import"./CctvFIMB.js";import"./DEM0ZUQO.js";import"./B_7avCj3.js";import"./Bht4QrSq.js";import"./CfbSr2Gk.js";import"./DBzH_qEX.js";import"./2WZ0EiyL.js";import"./B-TwICWZ.js";const N={email:/^[^\s@]+@[^\s@][^\s.@]*\.[^\s@]+$/},D=T({__name:"LoginFormComponent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(g){const a=P(g,"modelValue"),m=s=>{const e=[];return s.email||e.push({name:"email",message:"Required"}),N.email.test(String(s.email))||e.push({name:"email",message:"Invalid email format"}),s.password||e.push({name:"password",message:"Required"}),e};return(s,e)=>{const r=q,u=y,c=C;return U(),x(c,{state:a.value,validate:m,class:"flex flex-col gap-4"},{default:i(()=>[l(u,{label:"Email",name:"email"},{default:i(()=>[l(r,{modelValue:a.value.email,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.email=n),class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"Password",name:"password"},{default:i(()=>[l(r,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.password=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["state"])}}}),K=T({__name:"RegisterFormComponent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(g){const a=P(g,"modelValue"),m=s=>{var r;const e=[];return s.name||e.push({name:"name",message:"Required"}),N.email.test(String(s.email))||e.push({name:"email",message:"Invalid email format"}),s.password||e.push({name:"password",message:"Required"}),(r=s==null?void 0:s.password)!=null&&r.length&&s.password.length<8&&e.push({name:"password",message:"密碼長度至少8個字"}),s.confirmPassword||e.push({name:"confirmPassword",message:"Required"}),s.password!==s.confirmPassword&&e.push({name:"confirmPassword",message:"Password does not match"}),s.serialNumber||e.push({name:"serialNumber",message:"Required"}),e};return(s,e)=>{const r=q,u=y,c=C;return U(),x(c,{state:a.value,validate:m,class:"flex flex-col gap-4"},{default:i(()=>[l(u,{label:"姓名",name:"name"},{default:i(()=>[l(r,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.name=n),class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"Email",name:"email"},{default:i(()=>[l(r,{modelValue:a.value.email,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.email=n),class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"密碼",name:"password"},{default:i(()=>[l(r,{modelValue:a.value.password,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.password=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"確認密碼",name:"confirmPassword"},{default:i(()=>[l(r,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.confirmPassword=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"序號",name:"serialNumber"},{default:i(()=>[l(r,{modelValue:a.value.serialNumber,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.serialNumber=n),class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["state"])}}}),re=T({__name:"login",async setup(g){let a,m;const s=M(),e=S({data:{login:{email:"",password:""},register:{name:"",email:"",password:"",confirmPassword:"",serialNumber:""}}}),{data:r,execute:u,error:c,status:n}=([a,m]=V(()=>R.login(e.value.data.login)),a=await a,m(),a),{data:h,execute:F,status:L,error:$}=([a,m]=V(()=>R.register(e.value.data.register)),a=await a,m(),a),{data:A,refresh:E}=([a,m]=V(()=>R.checkValidToken()),a=await a,m(),a),J=[{label:"登入",icon:"i-lucide-user",slot:"login"},{label:"註冊",icon:"i-lucide-lock",slot:"register"}],B=async()=>{var w,f;const{login:t}=e.value.data;if(await u(),c.value){s.add({title:"錯誤帳號或密碼",color:"error"}),console.error(c.value),t.password="";return}const d=_(v.AccessToken),p=_(v.RefreshToken);d.value=((w=r.value)==null?void 0:w.token.accessTokenJWT)||"",p.value=((f=r.value)==null?void 0:f.token.refreshTokenJWT)||"",b(k.Home)},I=async()=>{var d,p;const{register:t}=e.value.data;if(await F(),$.value){s.add({title:"錯誤序號或重複註冊",color:"error"}),t.serialNumber="",t.password="",t.confirmPassword="";return}s.add({title:"註冊成功 請登入",color:"success"}),t.name="",t.email="",t.password="",t.confirmPassword="",t.serialNumber="",_(v.AccessToken).value=(d=h.value)==null?void 0:d.token.accessTokenJWT,_(v.RefreshToken).value=(p=h.value)==null?void 0:p.token.refreshTokenJWT,b(k.Home)};return W(async()=>{var t;await E(),((t=A.value)==null?void 0:t.msg)==="Token is valid"&&b(k.Home)}),(t,d)=>{const p=H,w=j;return U(),x(w,{items:J,class:"gap-4 w-full",ui:{trigger:"flex-1"}},{login:i(()=>[l(o(D),{modelValue:o(e).data.login,"onUpdate:modelValue":d[0]||(d[0]=f=>o(e).data.login=f)},null,8,["modelValue"]),l(p,{label:"登入",type:"submit",variant:"soft",class:"self-end",loading:o(n)==="pending",disabled:!o(e).data.login.email||!o(e).data.login.password||!o(e).data.login.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/),onClick:B},null,8,["loading","disabled"])]),register:i(()=>[l(o(K),{modelValue:o(e).data.register,"onUpdate:modelValue":d[1]||(d[1]=f=>o(e).data.register=f)},null,8,["modelValue"]),l(p,{label:"註冊",type:"submit",variant:"soft",class:"self-end",loading:o(L)==="pending",disabled:!o(e).data.register.name||!o(e).data.register.email||!o(e).data.register.password||!o(e).data.register.confirmPassword||!o(e).data.register.serialNumber||!o(e).data.register.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||o(e).data.register.password!==o(e).data.register.confirmPassword,onClick:I},null,8,["loading","disabled"])]),_:1})}}});export{re as default};
