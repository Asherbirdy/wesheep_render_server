import{e as T,a1 as h,j as x,o as U,w as i,b as l,ax as S,r as W,g as V,G as B,ar as b,ay as k,i as o,l as H,az as _,aA as v}from"./zYcgArxY.js";import{_ as j}from"./BClJ5BZq.js";import{u as R}from"./Do8Uqh4Z.js";import{_ as C,b as y,a as q}from"./D8LZ45Va.js";import"./LhalE0VN.js";import"./CSyGRmgO.js";import"./Bw4c4pFT.js";import"./BLi0_gz1.js";import"./3UrFv9Wb.js";const N={email:/^[^\s@]+@[^\s@][^\s.@]*\.[^\s@]+$/},z=T({__name:"LoginFormComponent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(g){const a=h(g,"modelValue"),m=s=>{const e=[];return s.email||e.push({name:"email",message:"Required"}),N.email.test(String(s.email))||e.push({name:"email",message:"Invalid email format"}),s.password||e.push({name:"password",message:"Required"}),e};return(s,e)=>{const r=y,u=q,c=C;return U(),x(c,{state:a.value,validate:m,class:"flex flex-col gap-4"},{default:i(()=>[l(u,{label:"Email",name:"email"},{default:i(()=>[l(r,{modelValue:a.value.email,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.email=n),class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"Password",name:"password"},{default:i(()=>[l(r,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.password=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["state"])}}}),G=T({__name:"RegisterFormComponent",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(g){const a=h(g,"modelValue"),m=s=>{var r;const e=[];return s.name||e.push({name:"name",message:"Required"}),N.email.test(String(s.email))||e.push({name:"email",message:"Invalid email format"}),s.password||e.push({name:"password",message:"Required"}),(r=s==null?void 0:s.password)!=null&&r.length&&s.password.length<8&&e.push({name:"password",message:"密碼長度至少8個字"}),s.confirmPassword||e.push({name:"confirmPassword",message:"Required"}),s.password!==s.confirmPassword&&e.push({name:"confirmPassword",message:"Password does not match"}),s.serialNumber||e.push({name:"serialNumber",message:"Required"}),e};return(s,e)=>{const r=y,u=q,c=C;return U(),x(c,{state:a.value,validate:m,class:"flex flex-col gap-4"},{default:i(()=>[l(u,{label:"姓名",name:"name"},{default:i(()=>[l(r,{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=n=>a.value.name=n),class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"Email",name:"email"},{default:i(()=>[l(r,{modelValue:a.value.email,"onUpdate:modelValue":e[1]||(e[1]=n=>a.value.email=n),class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"密碼",name:"password"},{default:i(()=>[l(r,{modelValue:a.value.password,"onUpdate:modelValue":e[2]||(e[2]=n=>a.value.password=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"確認密碼",name:"confirmPassword"},{default:i(()=>[l(r,{modelValue:a.value.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=n=>a.value.confirmPassword=n),type:"password",class:"w-full"},null,8,["modelValue"])]),_:1}),l(u,{label:"序號",name:"serialNumber"},{default:i(()=>[l(r,{modelValue:a.value.serialNumber,"onUpdate:modelValue":e[4]||(e[4]=n=>a.value.serialNumber=n),class:"w-full"},null,8,["modelValue"])]),_:1})]),_:1},8,["state"])}}}),oe=T({__name:"login",async setup(g){let a,m;const s=S(),e=W({data:{login:{email:"",password:""},register:{name:"",email:"",password:"",confirmPassword:"",serialNumber:""}}}),{data:r,execute:u,error:c,status:n}=([a,m]=V(()=>R.login(e.value.data.login)),a=await a,m(),a),{data:P,execute:F,status:$,error:A}=([a,m]=V(()=>R.register(e.value.data.register)),a=await a,m(),a),{data:L,refresh:E}=([a,m]=V(()=>R.checkValidToken()),a=await a,m(),a),I=[{label:"登入",icon:"i-lucide-user",slot:"login"},{label:"註冊",icon:"i-lucide-lock",slot:"register"}],J=async()=>{var w,f;const{login:t}=e.value.data;if(await u(),c.value){s.add({title:"錯誤帳號或密碼",color:"error"}),console.error(c.value),t.password="";return}const d=_(v.AccessToken),p=_(v.RefreshToken);d.value=((w=r.value)==null?void 0:w.token.accessTokenJWT)||"",p.value=((f=r.value)==null?void 0:f.token.refreshTokenJWT)||"",b(k.Home)},M=async()=>{var d,p;const{register:t}=e.value.data;if(await F(),A.value){s.add({title:"錯誤序號或重複註冊",color:"error"}),t.serialNumber="",t.password="",t.confirmPassword="";return}s.add({title:"註冊成功 請登入",color:"success"}),t.name="",t.email="",t.password="",t.confirmPassword="",t.serialNumber="",_(v.AccessToken).value=(d=P.value)==null?void 0:d.token.accessTokenJWT,_(v.RefreshToken).value=(p=P.value)==null?void 0:p.token.refreshTokenJWT,b(k.Home)};return B(async()=>{var t;await E(),((t=L.value)==null?void 0:t.msg)==="Token is valid"&&b(k.Home)}),(t,d)=>{const p=H,w=j;return U(),x(w,{items:I,class:"gap-4 w-full",ui:{trigger:"flex-1"}},{login:i(()=>[l(o(z),{modelValue:o(e).data.login,"onUpdate:modelValue":d[0]||(d[0]=f=>o(e).data.login=f)},null,8,["modelValue"]),l(p,{label:"登入",type:"submit",variant:"soft",class:"self-end",loading:o(n)==="pending",disabled:!o(e).data.login.email||!o(e).data.login.password||!o(e).data.login.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/),onClick:J},null,8,["loading","disabled"])]),register:i(()=>[l(o(G),{modelValue:o(e).data.register,"onUpdate:modelValue":d[1]||(d[1]=f=>o(e).data.register=f)},null,8,["modelValue"]),l(p,{label:"註冊",type:"submit",variant:"soft",class:"self-end",loading:o($)==="pending",disabled:!o(e).data.register.name||!o(e).data.register.email||!o(e).data.register.password||!o(e).data.register.confirmPassword||!o(e).data.register.serialNumber||!o(e).data.register.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||o(e).data.register.password!==o(e).data.register.confirmPassword,onClick:M},null,8,["loading","disabled"])]),_:1})}}});export{oe as default};
